[Unit]
Description=Plex IPTV Proxy FFProbe, meant to be run weekly (or monthly) by the corresponding timer, will test each channel (track) and store the test results to be used by the server
Requires=network.target
After=network.target

[Service]
Type=oneshot
User=plex-iptv-proxy
Group=plex-iptv-proxy
UMask=002
Environment=PATH=INSTALL_DIR/.nvm/versions/node/v20.18.1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
ExecStartPre=INSTALL_DIR/.nvm/versions/node/v20.18.1/bin/npm --prefix INSTALL_DIR install
ExecStart=INSTALL_DIR/.nvm/versions/node/v20.18.1/bin/npm --prefix INSTALL_DIR run ffprobe-store-results
ExecStartPost=INSTALL_DIR/.nvm/versions/node/v20.18.1/bin/npm --prefix INSTALL_DIR run generate-epg
WorkingDirectory=INSTALL_DIR
SyslogIdentifier=plex-iptv-proxy-ffprobe

[Install]
WantedBy=multi-user.target